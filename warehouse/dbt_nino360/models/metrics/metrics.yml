version: 2

metrics:
  - name: total_ar_open
    label: Total AR Open
    model: ref('mart_finance_ar_open')
    description: "Total accounts receivable outstanding"
    calculation_method: sum
    expression: amount_due
    timestamp: invoice_date_ist
    time_grains: [day, week, month, quarter, year]
    dimensions:
      - tenant_id
      - aging_bucket
      - currency
    
  - name: weighted_pipeline
    label: Weighted Pipeline Value
    model: ref('mart_crm_pipeline')
    description: "Sum of opportunity amounts weighted by probability"
    calculation_method: sum
    expression: weighted_amount
    timestamp: close_date_ist
    time_grains: [week, month, quarter]
    dimensions:
      - tenant_id
      - stage
    
  - name: avg_match_score
    label: Average Match Score
    model: ref('mart_hotlist_matches')
    description: "Average AI match score for hotlist candidates"
    calculation_method: average
    expression: match_score
    timestamp: matched_at_ist
    time_grains: [day, week, month]
    dimensions:
      - tenant_id
      - match_quality
    
  - name: course_completion_rate
    label: Course Completion Rate
    model: ref('mart_lms_completions')
    description: "Percentage of lessons completed"
    calculation_method: average
    expression: is_completed
    timestamp: started_at_ist
    time_grains: [week, month, quarter]
    dimensions:
      - tenant_id
